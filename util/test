#!/usr/bin/env sh

set -euo pipefail
IFS=$'\n\t'

server=
end() {
    kill "$server"
    printf " server stopped."
    exit
}
trap end INT

http-server src &> /dev/null &
server="$!"
sleep 0.5 && open "http://localhost:8080" &

while true; do find . \
    -not -path "*.git*" \
    -a -not -path "*node_modules*" \
    | entr -d make || [[ "$?" == 2 ]]
done
